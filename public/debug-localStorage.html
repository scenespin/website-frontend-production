<!DOCTYPE html>
<html>
<head>
    <title>LocalStorage Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
        button { margin: 10px 5px; padding: 10px; cursor: pointer; }
        .danger { background: #ff4444; color: white; }
        .safe { background: #44ff44; color: black; }
    </style>
</head>
<body>
    <h1>LocalStorage Inspector</h1>
    
    <button class="safe" onclick="inspectBeats()">Inspect Beats</button>
    <button class="danger" onclick="clearMigrationFlag()">Clear Migration Flag</button>
    <button class="danger" onclick="clearAllData()">Clear All Data (DANGER!)</button>
    
    <div id="output"></div>
    
    <script>
        function inspectBeats() {
            const output = document.getElementById('output');
            output.innerHTML = '<h2>üîç Inspection Results:</h2>';
            
            // Check migration flag
            const migrationFlag = localStorage.getItem('wryda_last_migration');
            output.innerHTML += `<h3>Migration Flag:</h3><pre>${migrationFlag || 'NOT SET'}</pre>`;
            
            // Check beats
            const beatsJSON = localStorage.getItem('screenplay_beats_v1');
            if (!beatsJSON) {
                output.innerHTML += '<h3>Beats:</h3><pre>NO BEATS IN LOCALSTORAGE</pre>';
                return;
            }
            
            try {
                const beats = JSON.parse(beatsJSON);
                output.innerHTML += `<h3>Beats (${beats.length} total):</h3>`;
                
                beats.forEach((beat, index) => {
                    const scenesType = Array.isArray(beat.scenes) ? 'array' : typeof beat.scenes;
                    const scenesValue = Array.isArray(beat.scenes) ? beat.scenes.length : beat.scenes;
                    const isCorrupted = !Array.isArray(beat.scenes);
                    
                    output.innerHTML += `
                        <pre style="background: ${isCorrupted ? '#ffcccc' : '#ccffcc'}">
Beat ${index + 1}: ${beat.title || beat.id}
  - scenes type: ${scenesType}
  - scenes value: ${scenesValue}
  - ${isCorrupted ? '‚ùå CORRUPTED!' : '‚úÖ OK'}
                        </pre>
                    `;
                });
            } catch (error) {
                output.innerHTML += `<h3>Error:</h3><pre>${error.message}</pre>`;
            }
        }
        
        function clearMigrationFlag() {
            if (confirm('This will allow the migration to run again on next page load. Continue?')) {
                localStorage.removeItem('wryda_last_migration');
                alert('Migration flag cleared! Reload the page to run migration.');
            }
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will DELETE ALL your screenplay data! Are you SURE?')) {
                if (confirm('Really? This cannot be undone!')) {
                    localStorage.clear();
                    alert('All data cleared. Refresh to start fresh.');
                }
            }
        }
        
        // Auto-run inspection on load
        inspectBeats();
    </script>
</body>
</html>

